{% extends 'base.html' %}

{% block title %}Gesti√≥n Inteligente de Actividades - Sistema Educativo{% endblock %}

{% block extra_css %}
<!-- Estilos espec√≠ficos cargados autom√°ticamente en base.html -->
{% endblock %}

{% block content %}
<div class="actividades-page">
    <div class="actividades-container actividades-fade-in">
        
        <!-- BREADCRUMB DE NAVEGACI√ìN -->
        <nav aria-label="breadcrumb" class="actividades-mb-lg">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{{ url_for('dashboard_simple.index') }}" class="text-decoration-none">
                        <i class="fas fa-home me-1"></i>Dashboard
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <i class="fas fa-graduation-cap me-1"></i>Gesti√≥n Inteligente de Actividades
                </li>
            </ol>
        </nav>

        <!-- HEADER PRINCIPAL EDUCATIVO -->
        <div class="actividades-header">
            <div class="actividades-header-content">
                <div>
                    <h1 class="actividades-title">
                        <i class="fas fa-graduation-cap text-primary"></i>
                        Gesti√≥n Inteligente de Actividades
                    </h1>
                    <p class="actividades-subtitle actividades-mb-0">
                        Sistema educativo avanzado para planificar, ejecutar y monitorear todas las actividades de tu operaci√≥n ganadera con inteligencia artificial y mejores pr√°cticas.
                    </p>
                </div>
                <div class="actividades-actions">
                    <a href="{{ url_for('actividades.nueva') }}" class="btn btn-success">
                        <i class="fas fa-plus me-2"></i>
                        Nueva Actividad
                    </a>
                    <button type="button" class="btn btn-outline-primary" onclick="exportarDatos()">
                        <i class="fas fa-download me-2"></i>
                        Exportar Datos
                    </button>
                </div>
            </div>
        </div>

        <!-- DASHBOARD DE ESTAD√çSTICAS EDUCATIVO -->
        <div class="actividades-stats-section">
            <h3 class="actividades-section-title">
                <i class="fas fa-chart-bar text-info"></i>
                Panel de Control Inteligente
            </h3>
            <div class="actividades-stats">
                <div class="actividades-stat-item actividades-stat-warning">
                    <div class="actividades-stat-content">
                        <div class="actividades-stat-value">{{ stats.pendientes or 0 }}</div>
                        <div class="actividades-stat-label">Actividades Pendientes</div>
                        <div class="actividades-stat-description">Requieren atenci√≥n prioritaria</div>
                    </div>
                    <div class="actividades-stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
                
                <div class="actividades-stat-item actividades-stat-info">
                    <div class="actividades-stat-content">
                        <div class="actividades-stat-value">{{ stats.en_progreso or 0 }}</div>
                        <div class="actividades-stat-label">En Progreso</div>
                        <div class="actividades-stat-description">Siendo ejecutadas actualmente</div>
                    </div>
                    <div class="actividades-stat-icon">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </div>
                
                <div class="actividades-stat-item actividades-stat-success">
                    <div class="actividades-stat-content">
                        <div class="actividades-stat-value">{{ stats.completadas or 0 }}</div>
                        <div class="actividades-stat-label">Completadas</div>
                        <div class="actividades-stat-description">Finalizadas exitosamente</div>
                    </div>
                    <div class="actividades-stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                
                <div class="actividades-stat-item actividades-stat-primary">
                    <div class="actividades-stat-content">
                        <div class="actividades-stat-value">{{ stats.total or 0 }}</div>
                        <div class="actividades-stat-label">Total de Actividades</div>
                        <div class="actividades-stat-description">Registro hist√≥rico completo</div>
                    </div>
                    <div class="actividades-stat-icon">
                        <i class="fas fa-list-alt"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN DE FILTROS INTELIGENTES -->
        <div class="actividades-filters-section">
            <div class="actividades-filters-header">
                <h3 class="actividades-section-title">
                    <i class="fas fa-brain text-success"></i>
                    Filtros Inteligentes IA
                </h3>
                <p class="actividades-section-subtitle">
                    Utiliza nuestro sistema avanzado de filtros para encontrar exactamente lo que necesitas
                </p>
            </div>
            
            <form method="GET" class="actividades-filters-form">
                <div class="actividades-filters-grid">
                    <div class="actividades-filter-group">
                        <label class="actividades-filter-label">
                            <i class="fas fa-flag text-warning"></i>
                            Estado de la Actividad
                        </label>
                        <select name="estado" class="actividades-filter-select">
                            <option value="">üîç Todos los estados</option>
                            <option value="Pendiente" {{ 'selected' if request.args.get('estado') == 'Pendiente' }}>‚è∞ Pendiente</option>
                            <option value="En Progreso" {{ 'selected' if request.args.get('estado') == 'En Progreso' }}>üîÑ En Progreso</option>
                            <option value="Completada" {{ 'selected' if request.args.get('estado') == 'Completada' }}>‚úÖ Completada</option>
                            <option value="Cancelada" {{ 'selected' if request.args.get('estado') == 'Cancelada' }}>‚ùå Cancelada</option>
                        </select>
                    </div>
                    
                    <div class="actividades-filter-group">
                        <label class="actividades-filter-label">
                            <i class="fas fa-cogs text-primary"></i>
                            Tipo de Actividad
                        </label>
                        <select name="tipo_actividad" class="actividades-filter-select">
                            <option value="">üîç Todos los tipos</option>
                            <option value="Riego" {{ 'selected' if request.args.get('tipo_actividad') == 'Riego' }}>üíß Riego</option>
                            <option value="Fumigaci√≥n" {{ 'selected' if request.args.get('tipo_actividad') == 'Fumigaci√≥n' }}>üåø Fumigaci√≥n</option>
                            <option value="Fertilizaci√≥n" {{ 'selected' if request.args.get('tipo_actividad') == 'Fertilizaci√≥n' }}>üå± Fertilizaci√≥n</option>
                            <option value="Reparaci√≥n de Cercas" {{ 'selected' if request.args.get('tipo_actividad') == 'Reparaci√≥n de Cercas' }}>üî® Reparaciones</option>
                            <option value="Limpieza" {{ 'selected' if request.args.get('tipo_actividad') == 'Limpieza' }}>üßπ Limpieza</option>
                            <option value="Otro" {{ 'selected' if request.args.get('tipo_actividad') == 'Otro' }}>‚öôÔ∏è Otro</option>
                        </select>
                    </div>
                    
                    <div class="actividades-filter-group">
                        <label class="actividades-filter-label">
                            <i class="fas fa-map-marker-alt text-success"></i>
                            Potrero
                        </label>
                        <select name="potrero_id" class="actividades-filter-select">
                            <option value="">üåæ Todos los potreros</option>
                            {% for potrero in potreros %}
                            <option value="{{ potrero.id }}" {{ 'selected' if request.args.get('potrero_id')|string == potrero.id|string }}>
                                {{ potrero.nombre }} ({{ potrero.hectareas }} ha)
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="actividades-filter-group">
                        <label class="actividades-filter-label">
                            <i class="fas fa-calendar-alt text-info"></i>
                            Rango de Fechas
                        </label>
                        <div class="actividades-date-range">
                            <input type="date" name="fecha_inicio" class="actividades-filter-input" 
                                   placeholder="Fecha inicio" value="{{ request.args.get('fecha_inicio', '') }}">
                            <span class="actividades-date-separator">hasta</span>
                            <input type="date" name="fecha_fin" class="actividades-filter-input" 
                                   placeholder="Fecha fin" value="{{ request.args.get('fecha_fin', '') }}">
                        </div>
                    </div>
                </div>
                
                <div class="actividades-filters-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Aplicar Filtros Inteligentes
                    </button>
                    <a href="{{ url_for('actividades.index_educational') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-refresh me-2"></i>Limpiar Filtros
                    </a>
                </div>
            </form>
        </div>

        <!-- CONSEJO EDUCATIVO INTELIGENTE -->
        <div class="actividades-educational-section">
            <div class="actividad-card actividades-educational-card">
                <div class="actividad-card-header">
                    <h5 class="actividades-mb-0">
                        <i class="fas fa-graduation-cap text-success"></i>
                        Consejo de Gesti√≥n Inteligente
                    </h5>
                </div>
                <div class="actividad-card-body">
                    <div class="actividades-educational-content">
                        <div class="actividades-educational-icon">
                            <i class="fas fa-brain text-primary"></i>
                        </div>
                        <div class="actividades-educational-text">
                            <h6 class="text-primary mb-2">üí° Optimizaci√≥n con IA</h6>
                            <p class="actividades-mb-sm">
                                <strong>Planifica con anticipaci√≥n inteligente:</strong> Las actividades bien programadas son la clave del √©xito. 
                                Mant√©n un calendario actualizado y asigna responsables claros para cada tarea.
                            </p>
                            <p class="actividades-mb-0 text-muted">
                                Nuestro sistema IA te ayuda a optimizar recursos, predecir necesidades y mejorar la productividad de tu operaci√≥n ganadera.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Lista de Actividades o Timeline -->
    {% if actividades %}
    <div class="template-grid">
        <div class="col-8">
            <div class="activity-smart-card">
                <h4 class="mb-3">
                    <i class="fas fa-calendar-alt me-2"></i>
                    Actividades Programadas
                </h4>
                
                <div class="activity-timeline">
                    {% for actividad in actividades %}
                    <div class="timeline-item">
                        <div class="timeline-marker">
                            {% if actividad.tipo_actividad == 'Riego' %}
                                <i class="fas fa-tint"></i>
                            {% elif actividad.tipo_actividad == 'Fumigaci√≥n' %}
                                <i class="fas fa-spray-can"></i>
                            {% elif actividad.tipo_actividad == 'Fertilizaci√≥n' %}
                                <i class="fas fa-seedling"></i>
                            {% elif actividad.tipo_actividad == 'Reparaci√≥n' %}
                                <i class="fas fa-wrench"></i>
                            {% elif actividad.tipo_actividad == 'Limpieza' %}
                                <i class="fas fa-broom"></i>
                            {% else %}
                                <i class="fas fa-cog"></i>
                            {% endif %}
                        </div>
                        
                        <div class="activity-content">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="mb-1">{{ actividad.tipo_actividad }}</h5>
                                <span class="badge rounded-pill 
                                    {% if actividad.estado == 'Pendiente' %}bg-warning
                                    {% elif actividad.estado == 'En Progreso' %}bg-info
                                    {% elif actividad.estado == 'Completada' %}bg-success
                                    {% else %}bg-danger{% endif %}">
                                    {{ actividad.estado }}
                                </span>
                            </div>
                            
                            <p class="mb-2">{{ actividad.descripcion }}</p>
                            
                            <div class="row g-2 text-sm">
                                <div class="col-6">
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    <strong>Potrero:</strong> {{ actividad.potrero_nombre if actividad.potrero_nombre else 'Sin asignar' }}
                                </div>
                                <div class="col-6">
                                    <i class="fas fa-calendar me-1"></i>
                                    <strong>Fecha:</strong> {{ actividad.fecha.strftime('%d/%m/%Y') }}
                                </div>
                                {% if actividad.responsable %}
                                <div class="col-6">
                                    <i class="fas fa-user me-1"></i>
                                    <strong>Responsable:</strong> {{ actividad.responsable }}
                                </div>
                                {% endif %}
                                {% if actividad.costo %}
                                <div class="col-6">
                                    <i class="fas fa-dollar-sign me-1"></i>
                                    <strong>Costo:</strong> ${{ "{:,.0f}".format(actividad.costo) }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="mt-3">
                                <a href="{{ url_for('actividades.edit', actividad_id=actividad.id) }}" 
                                   class="btn btn-outline-primary btn-sm rounded-pill">
                                    <i class="fas fa-edit me-1"></i>Editar
                                </a>
                                <button onclick="confirmarEliminacion({{ actividad.id }})" 
                                        class="btn btn-outline-danger btn-sm rounded-pill">
                                    <i class="fas fa-trash me-1"></i>Eliminar
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
            
            <!-- SIDEBAR EDUCATIVO -->
            <div class="actividades-sidebar">
                
                <!-- M√©tricas Educativas Inteligentes -->
                <div class="actividad-card actividades-mb-lg">
                    <div class="actividad-card-header">
                        <h5 class="actividades-mb-0">
                            <i class="fas fa-brain text-warning"></i>
                            An√°lisis Inteligente
                        </h5>
                    </div>
                    <div class="actividad-card-body">
                        <div class="actividades-insight-item">
                            <div class="actividades-insight-icon">
                                <i class="fas fa-exclamation-triangle text-warning"></i>
                            </div>
                            <div class="actividades-insight-content">
                                <h6 class="actividades-insight-title">Actividades Urgentes</h6>
                                <p class="actividades-insight-text">
                                    Tienes <strong>{{ stats.pendientes or 0 }}</strong> actividades pendientes que requieren atenci√≥n prioritaria.
                                </p>
                            </div>
                        </div>
                        
                        <div class="actividades-insight-item">
                            <div class="actividades-insight-icon">
                                <i class="fas fa-chart-trending-up text-success"></i>
                            </div>
                            <div class="actividades-insight-content">
                                <h6 class="actividades-insight-title">Productividad</h6>
                                <p class="actividades-insight-text">
                                    Has completado <strong>{{ stats.completadas or 0 }}</strong> actividades. ¬°Excelente trabajo!
                                </p>
                            </div>
                        </div>
                        
                        <div class="actividades-insight-item">
                            <div class="actividades-insight-icon">
                                <i class="fas fa-chart-pie text-info"></i>
                            </div>
                            <div class="actividades-insight-content">
                                <h6 class="actividades-insight-title">Control de Costos</h6>
                                <p class="actividades-insight-text">
                                    Monitorea costos para maximizar rentabilidad y mantener presupuesto equilibrado.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recomendaciones IA -->
                <div class="actividad-card">
                    <div class="actividad-card-header">
                        <h5 class="actividades-mb-0">
                            <i class="fas fa-robot text-primary"></i>
                            Recomendaciones IA
                        </h5>
                    </div>
                    <div class="actividad-card-body">
                        <ul class="actividades-recommendations">
                            <li>Programa actividades de riego antes de temporadas secas</li>
                            <li>Coordina fertilizaci√≥n con ciclos de crecimiento del pasto</li>
                            <li>Planifica reparaciones durante periodos de menor actividad</li>
                            <li>Mant√©n reservas de emergencia para actividades cr√≠ticas</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- ESTADO VAC√çO EDUCATIVO -->
        <div class="actividades-empty-state">
            <div class="actividad-card actividades-empty-card">
                <div class="actividades-empty-content">
                    <div class="actividades-empty-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3 class="actividades-empty-title">
                        ¬°Comienza tu Gesti√≥n Inteligente!
                    </h3>
                    <p class="actividades-empty-description">
                        A√∫n no tienes actividades registradas. Nuestro sistema educativo te guiar√° paso a paso 
                        para crear un plan de actividades eficiente y organizado.
                    </p>
                    <div class="actividades-empty-actions">
                        <a href="{{ url_for('actividades.nueva_educational') }}" class="btn btn-success btn-lg">
                            <i class="fas fa-plus me-2"></i>Crear Primera Actividad
                        </a>
                        <a href="{{ url_for('actividades.nueva') }}" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-lightbulb me-2"></i>Ver Modo Simple
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="actividad-card actividades-mt-lg">
                <div class="actividad-card-header">
                    <h5 class="actividades-mb-0">
                        <i class="fas fa-map text-info"></i>
                        Gu√≠a de Inicio Inteligente
                    </h5>
                </div>
                <div class="actividad-card-body">
                    <div class="actividades-startup-guide">
                        <div class="actividades-guide-step">
                            <div class="actividades-guide-number">1</div>
                            <div class="actividades-guide-content">
                                <h6>Identifica tus Necesidades</h6>
                                <p>Eval√∫a qu√© actividades requieren tus potreros (riego, fertilizaci√≥n, mantenimiento).</p>
                            </div>
                        </div>
                        <div class="actividades-guide-step">
                            <div class="actividades-guide-number">2</div>
                            <div class="actividades-guide-content">
                                <h6>Programa Estrategicamente</h6>
                                <p>Usa nuestro sistema IA para optimizar tiempos y recursos en cada actividad.</p>
                            </div>
                        </div>
                        <div class="actividades-guide-step">
                            <div class="actividades-guide-number">3</div>
                            <div class="actividades-guide-content">
                                <h6>Monitorea y Ajusta</h6>
                                <p>Sigue el progreso en tiempo real y ajusta seg√∫n las condiciones y resultados.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- BOT√ìN DE AYUDA FLOTANTE -->
<div class="actividades-floating-help">
    <button class="actividades-help-button" onclick="mostrarAyuda()" title="Asistente IA de Actividades">
        <i class="fas fa-robot"></i>
    </button>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modules/actividades.js') }}"></script>
<script>
// JavaScript espec√≠fico para modo educativo
function mostrarAyuda() {
    alert('Asistente IA: \n\n¬°Hola! Soy tu asistente para gesti√≥n inteligente de actividades. \n\nPuedes usar los filtros avanzados para encontrar actividades espec√≠ficas, o crear nuevas actividades con nuestro sistema de recomendaciones autom√°ticas. \n\n¬øNecesitas ayuda con algo espec√≠fico?');
}

function exportarDatos() {
    // L√≥gica para exportar datos en formato educativo
    const actividades = document.querySelectorAll('.actividades-timeline-item');
    if (actividades.length > 0) {
        alert('Exportando datos de ' + actividades.length + ' actividades...');
    } else {
        alert('No hay actividades para exportar.');
    }
}
</script>
{% endblock %} 